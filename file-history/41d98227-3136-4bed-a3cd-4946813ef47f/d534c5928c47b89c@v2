import { NextResponse } from 'next/server';

export type APIErrorResponse = {
  error: string;
  message: string;
  timestamp: string;
  requestId?: string;
  details?: unknown;
};

/**
 * Standardized error response generator for API routes
 *
 * @param operation - Human-readable operation name (e.g., "search ZEREZ database")
 * @param error - The caught error object
 * @param statusCode - HTTP status code (default: 500)
 * @param details - Optional additional context for debugging
 * @returns NextResponse with standardized error format
 *
 * @example
 * ```typescript
 * try {
 *   const data = await fetchData();
 *   return NextResponse.json(data);
 * } catch (error) {
 *   return createErrorResponse('fetch data', error);
 * }
 * ```
 */
export function createErrorResponse(
  operation: string,
  error: unknown,
  statusCode: number = 500,
  details?: unknown
): NextResponse<APIErrorResponse> {
  const timestamp = new Date().toISOString();
  const message = error instanceof Error ? error.message : 'Unknown error';

  // Log error with full context
  console.error(`[${operation}] Error at ${timestamp}:`, {
    message,
    statusCode,
    details,
    stack: error instanceof Error ? error.stack : undefined
  });

  const responseBody: APIErrorResponse = {
    error: `Failed to ${operation}`,
    message,
    timestamp,
  };

  if (details !== undefined) {
    responseBody.details = details;
  }

  return NextResponse.json(responseBody, { status: statusCode });
}
