/**
 * ZEREZ Importer Configuration Constants
 *
 * Centralized configuration for business logic values, limits, and thresholds
 * used throughout the ZEREZ import workflow.
 */

import path from 'path';

export const ZEREZ_IMPORT_LIMITS = {
  /** Maximum products that can be imported in a single batch (to prevent timeouts) */
  MAX_PRODUCTS_PER_IMPORT: 100,

  /** Maximum results returned by GraphQL search API (no practical limit for import) */
  MAX_SEARCH_RESULTS: 1000000,

  /** Preview limit for faster UI response (only show first N products) */
  PREVIEW_PRODUCT_LIMIT: 20,

  /** Maximum manufacturers shown in dropdown before requiring search */
  MANUFACTURER_DROPDOWN_LIMIT: 50,

  /** Maximum errors displayed in UI before truncating */
  MAX_DISPLAYED_ERRORS: 5,
} as const;

export const DEFAULT_FILTERS = {
  /** Default power range for ZEREZ search (kW) - null means no power restriction */
  POWER_MIN: null as number | null,
  POWER_MAX: null as number | null,

  /** Default voltage range for ZEREZ search (V) - null means no voltage restriction */
  VOLTAGE_MIN: null as number | null,
  VOLTAGE_MAX: null as number | null,

  /** Default compliance filters */
  IS_VERIFIED: true,
}; // Note: No 'as const' here - these values are used as mutable state initializers

/**
 * Available certificate standards for filtering ZEREZ products
 * These are the most common German and international standards for grid-connected devices
 */
export const CERTIFICATE_NORMS = [
  { value: 'VDE-AR-N 4105', label: 'VDE-AR-N 4105', description: 'Low voltage grid connection' },
  { value: 'VDE-AR-N 4110', label: 'VDE-AR-N 4110', description: 'Medium voltage grid connection' },
  { value: 'VDE-AR-N 4120', label: 'VDE-AR-N 4120', description: 'High voltage grid connection' },
  { value: 'VDE-AR-N 4130', label: 'VDE-AR-N 4130', description: 'Distribution system operation' },
  { value: 'CE', label: 'CE', description: 'European Conformity marking' },
  { value: 'IEC', label: 'IEC', description: 'International Electrotechnical Commission' },
] as const;

/**
 * Type representing a single certificate norm object
 */
export type CertificateNorm = typeof CERTIFICATE_NORMS[number];

/**
 * Union type of all valid certificate norm values
 * Use this type for type-safe certificate norm validation
 *
 * @example
 * ```typescript
 * const norm: CertificateNormValue = 'VDE-AR-N 4105'; // OK
 * const invalid: CertificateNormValue = 'INVALID'; // Type error
 * ```
 */
export type CertificateNormValue = typeof CERTIFICATE_NORMS[number]['value'];

/**
 * Type guard to check if a string is a valid certificate norm value
 *
 * @param value - String to validate
 * @returns True if value is a valid certificate norm
 *
 * @example
 * ```typescript
 * const userInput: string = getInputFromAPI();
 * if (isCertificateNormValue(userInput)) {
 *   // userInput is now typed as CertificateNormValue
 *   filters.certificateNorms.push(userInput);
 * }
 * ```
 */
export function isCertificateNormValue(value: string): value is CertificateNormValue {
  return CERTIFICATE_NORMS.some(norm => norm.value === value);
}

/** Sentinel value for "show all" options in select dropdowns (Radix doesn't allow empty strings) */
export const ALL_OPTIONS_SENTINEL: string = '__ALL__';

/**
 * ZEREZ directory paths relative to repository root
 * Use getZEREZPath() to get absolute paths
 */
export const ZEREZ_PATHS = {
  /** Base directory for all ZEREZ data */
  DATA_ROOT: 'data/zerez',

  /** Directory for imported JSON files from ZEREZ API */
  IMPORTS: 'data/zerez/imports',

  /** Directory for test imports (used during development/testing) */
  TEST_IMPORTS: 'data/zerez/imports/test',

  /** Directory for API export cache */
  API_EXPORTS: 'data/zerez/api_exports',
} as const;

/**
 * Get absolute path for ZEREZ directory
 *
 * @param type - Type of ZEREZ directory from ZEREZ_PATHS
 * @param repoRoot - Optional repository root (defaults to REPO_ROOT env or process.cwd()/..)
 * @returns Absolute path to the requested ZEREZ directory
 *
 * @example
 * ```ts
 * import { getZEREZPath } from '@/lib/zerez-constants';
 *
 * const importsDir = getZEREZPath('IMPORTS');
 * // Returns: /absolute/path/to/repo/data/zerez/imports
 * ```
 */
export function getZEREZPath(
  type: keyof typeof ZEREZ_PATHS,
  repoRoot?: string
): string {
  const root = repoRoot || process.env.REPO_ROOT || path.join(process.cwd(), '..');
  return path.join(root, ZEREZ_PATHS[type]);
}
