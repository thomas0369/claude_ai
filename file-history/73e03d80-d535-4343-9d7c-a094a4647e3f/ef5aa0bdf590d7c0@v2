/**
 * Quick Error Check
 * Test if the infinite re-render bug is fixed
 */

import { test, expect } from '@playwright/test';

test('Production game - no infinite loop errors', async ({ page }) => {
  const errors: string[] = [];

  // Capture page errors
  page.on('pageerror', exception => {
    const errorMsg = exception.toString();
    console.log(`❌ ERROR: ${errorMsg}`);
    errors.push(errorMsg);
  });

  // Capture console errors
  page.on('console', msg => {
    if (msg.type() === 'error') {
      const text = msg.text();
      console.log(`❌ CONSOLE ERROR: ${text}`);
      if (text.includes('Maximum update depth')) {
        errors.push(text);
      }
    }
  });

  console.log('Loading production game page...');
  await page.goto('http://localhost:3000/play/1');
  await page.waitForLoadState('networkidle');

  // Wait a bit to see if errors appear
  await page.waitForTimeout(5000);

  console.log(`\nTotal errors: ${errors.length}`);

  if (errors.length > 0) {
    console.log('\n❌ ERRORS FOUND:');
    errors.forEach((err, i) => {
      console.log(`${i + 1}. ${err.substring(0, 200)}...`);
    });
  } else {
    console.log('\n✅ NO ERRORS - Bug is fixed!');
  }

  // Take screenshot
  await page.screenshot({
    path: 'test-results/error-check.png',
    fullPage: true
  });

  // Test should pass only if no errors
  expect(errors.length).toBe(0);
});
