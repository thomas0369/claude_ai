# Block Puzzle Hero - Design System

**Version**: 2.0 (Konva Migration)
**Last Updated**: 2025-11-04

---

## Design Philosophy

### Core Principles

1. **Consistency First**
   - All game components share the same visual language
   - Standardized spacing, colors, and typography
   - Predictable user interactions

2. **Dark Theme by Default**
   - Reduces eye strain during extended play
   - Modern, professional appearance
   - Better focus on colorful game blocks

3. **Performance-Conscious**
   - Minimal DOM elements
   - Canvas-based rendering for game area
   - Optimized for 60 FPS gameplay

4. **Accessibility-Ready**
   - High contrast ratios
   - Clear visual feedback
   - Semantic HTML structure

---

## Color System

### Base Palette

```typescript
// Background Layers
const COLORS = {
  bg: {
    primary: '#1f2937',      // gray-800 - Main containers
    secondary: '#374151',    // gray-700 - Secondary containers
    tertiary: '#1a1a2e',     // Custom dark blue - Canvas background
    overlay: 'rgba(31, 41, 55, 0.5)', // Semi-transparent overlays
  },

  // Borders & Dividers
  border: {
    primary: '#374151',      // gray-700 - Main borders
    secondary: '#2a2a3e',    // Subtle blue-gray - Grid borders
    tertiary: '#2a2a4e',     // Cell dividers
  },

  // Text
  text: {
    primary: '#ffffff',      // White - Main text
    secondary: '#9ca3af',    // gray-400 - Secondary text
    tertiary: '#6b7280',     // gray-500 - Disabled text
  },

  // Accents & Status
  accent: {
    success: '#10b981',      // green-400 - Konva indicator, success states
    warning: '#fbbf24',      // yellow-400 - Combo multiplier
    error: '#ef4444',        // red-500 - Error states
    info: '#3b82f6',         // blue-500 - Info messages
  },

  // Game Blocks (from level config)
  blocks: {
    red: '#FF6B6B',
    teal: '#4ECDC4',
    blue: '#45B7D1',
    orange: '#FFA07A',
    mint: '#98D8C8',
    yellow: '#F7DC6F',
  },
};
```

### Color Usage Guidelines

**Backgrounds**:
- Main game container: `bg.primary` with `border.primary`
- Canvas area: `bg.tertiary`
- Info panels: `bg.overlay` with `border.primary`

**Text**:
- Headings & labels: `text.secondary`
- Values & numbers: `text.primary`
- Descriptive text: Use sparingly, prioritize visual hierarchy

**Accents**:
- Engine indicator (Konva.js): `accent.success`
- Combo multiplier: `accent.warning`
- Active/selected states: `accent.info`

---

## Typography

### Font Stack

```css
font-family: system-ui, -apple-system, BlinkMacSystemFont,
             'Segoe UI', Roboto, 'Helvetica Neue', Arial,
             sans-serif;
```

### Scale

```typescript
const FONT_SIZES = {
  xs: '0.75rem',    // 12px - Micro labels
  sm: '0.875rem',   // 14px - Info panel text
  base: '1rem',     // 16px - Canvas instructions
  lg: '1.125rem',   // 18px - Secondary headings
  xl: '1.25rem',    // 20px - Loading messages
  '2xl': '1.5rem',  // 24px - HUD labels
  '4xl': '2.25rem', // 36px - Score display
  '5xl': '3rem',    // 48px - Page titles
};

const FONT_WEIGHTS = {
  normal: 400,      // Body text
  medium: 500,      // Labels
  semibold: 600,    // Subheadings
  bold: 700,        // Headings, emphasis
};
```

### Usage

- **Score Display**: 4xl, bold, `accent.warning`
- **Level Number**: 2xl, bold, `text.primary`
- **Info Labels**: sm, normal, `text.secondary`
- **Info Values**: sm, bold, `text.primary`
- **Instructions**: base, normal, `text.secondary`

---

## Spacing System

### Base Unit: 4px (0.25rem)

```typescript
const SPACING = {
  px: '1px',
  0: '0',
  1: '0.25rem',  // 4px
  2: '0.5rem',   // 8px
  3: '0.75rem',  // 12px
  4: '1rem',     // 16px - Standard gap
  6: '1.5rem',   // 24px - Section spacing
  8: '2rem',     // 32px - Large spacing
  12: '3rem',    // 48px - Very large spacing
  16: '4rem',    // 64px - Extra large spacing
};
```

### Application

**Padding**:
- Game container: `p-4` (16px all sides)
- Info panels: `px-4 py-2` (16px horizontal, 8px vertical)
- Score display: `px-8 py-4` (32px horizontal, 16px vertical)

**Margins**:
- Between sections: `mt-4` or `mt-6`
- Between info badges: `gap-4`
- Below score: `mb-6`

**Grid Constants**:
```typescript
const GRID_OFFSET_X = 50;  // Left margin
const GRID_OFFSET_Y = 50;  // Top margin
const CELL_SIZE = 50;      // Cell dimension
const SPAWN_Y = GRID_OFFSET_Y + (GRID_SIZE * CELL_SIZE) + 80; // Block spawn area
```

---

## Component Patterns

### Game Container

```tsx
<div className="flex flex-col items-center">
  {/* Game canvas */}
  <div className="bg-gray-800 rounded-xl shadow-2xl p-4 border border-gray-700">
    <Stage width={600} height={700}>
      {/* Konva layers */}
    </Stage>
  </div>

  {/* Info panel */}
  <div className="mt-4 flex gap-4 text-gray-300 text-sm">
    {/* Status badges */}
  </div>
</div>
```

### Info Badge

```tsx
<div className="bg-gray-800/50 px-4 py-2 rounded-lg border border-gray-700">
  <span className="text-gray-400">{label}:</span>{' '}
  <span className="font-bold text-white">{value}</span>
</div>
```

### Score Display (HUD)

```tsx
<div className="bg-gray-800/50 rounded-lg px-8 py-4 border border-gray-700">
  <div className="text-center">
    <div className="text-yellow-400 text-4xl font-bold mb-1">{score}</div>
    <div className="text-gray-400 text-sm">SCORE</div>
  </div>
</div>
```

### Loading State

```tsx
<div className="flex items-center justify-center bg-gray-800 rounded-xl shadow-2xl p-4 border border-gray-700"
     style={{ width: 600, height: 700 }}>
  <div className="text-center">
    <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-green-500 mx-auto mb-4"></div>
    <p className="text-white text-xl">Loading Konva Game...</p>
  </div>
</div>
```

---

## Canvas Elements

### Grid

```typescript
// Background
<Rect
  x={GRID_OFFSET_X}
  y={GRID_OFFSET_Y}
  width={GRID_SIZE * CELL_SIZE}
  height={GRID_SIZE * CELL_SIZE}
  fill="#1a1a2e"          // bg.tertiary
  stroke="#2a2a3e"        // border.secondary
  strokeWidth={2}
/>

// Cell borders
<Rect
  x={x}
  y={y}
  width={CELL_SIZE}
  height={CELL_SIZE}
  stroke="#2a2a4e"        // border.tertiary
  strokeWidth={1}
/>

// Filled cell
<Rect
  x={x + 2}
  y={y + 2}
  width={CELL_SIZE - 4}
  height={CELL_SIZE - 4}
  fill={blockColor}
  cornerRadius={4}
/>
```

### Blocks

```typescript
<Rect
  x={x}
  y={y}
  width={CELL_SIZE - 4}
  height={CELL_SIZE - 4}
  fill={block.color}       // From COLORS.blocks
  stroke="#ffffff"         // White stroke
  strokeWidth={2}
  cornerRadius={6}
  shadowColor="black"
  shadowBlur={10}
  shadowOpacity={0.5}
/>
```

### Text

```typescript
<Text
  text="Drag blocks onto the grid"
  x={50}
  y={SPAWN_Y - 40}
  fontSize={16}
  fill="#888"              // Subtle gray
  width={500}
  align="center"
/>
```

---

## Interaction States

### Cursor Feedback

```typescript
// Idle
stage.container().style.cursor = 'default';

// Hovering draggable
stage.container().style.cursor = 'grab';

// Dragging
stage.container().style.cursor = 'grabbing';
```

### Block States

**At Rest**:
- No additional effects
- Standard shadow

**During Drag**:
- Cursor changes to 'grabbing'
- Block follows mouse position
- Grid remains static

**Invalid Placement**:
- Smooth animation back to origin
- Duration: 0.3s
- No color change

**Valid Placement**:
- Block disappears
- Grid cells fill with block color
- Score updates immediately
- Combo indicator appears if applicable

---

## Animation Standards

### Durations

```typescript
const ANIMATION_DURATIONS = {
  instant: 0,
  fast: 0.15,       // Quick feedback (150ms)
  normal: 0.3,      // Standard (300ms) - used for return-to-origin
  slow: 0.5,        // Deliberate (500ms) - used for respawn delay
};
```

### Easing

- **Default**: Linear (Konva's `to()` method default)
- **Smooth returns**: Built-in easing from Konva
- **No complex easing needed** for this game type

### Usage

```typescript
// Return to origin (invalid placement)
shape.to({
  x: block.originalX,
  y: block.originalY,
  duration: 0.3,  // ANIMATION_DURATIONS.normal
});

// Respawn delay (after all blocks placed)
setTimeout(spawnBlocks, 500); // ANIMATION_DURATIONS.slow
```

---

## Responsive Considerations

### Fixed Canvas Size

The game canvas is **fixed at 600x700px** for consistent gameplay experience:

- Grid: 8x8 cells @ 50px = 400x400px
- Margins: 50px top/left
- Block spawn area: 80px below grid

### Container Responsiveness

```tsx
// Desktop (default)
<div className="container mx-auto px-4 py-8">
  <div className="max-w-6xl mx-auto">
    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
      {/* HUD */}
      {/* Game */}
    </div>
  </div>
</div>

// The canvas itself remains 600x700px
// Scrolling enabled on smaller screens
```

---

## Accessibility

### Color Contrast

All text meets WCAG AA standards:

- `text.primary` (#ffffff) on `bg.primary` (#1f2937): **15.3:1** ✅
- `text.secondary` (#9ca3af) on `bg.primary` (#1f2937): **6.1:1** ✅
- `accent.success` (#10b981) on `bg.primary` (#1f2937): **4.8:1** ✅

### Visual Feedback

- **Cursor changes**: Clear indication of interactive elements
- **Animation**: Smooth return for invalid placement
- **Score updates**: Immediate visual feedback
- **Combo indicator**: Only shown when active (reduces noise)

### Future Improvements

- [ ] Keyboard navigation support
- [ ] Screen reader announcements
- [ ] High contrast mode
- [ ] Reduced motion option

---

## Implementation Checklist

When creating new game components:

- [ ] Use `bg.primary` for main containers
- [ ] Apply `rounded-xl shadow-2xl` to game canvas container
- [ ] Use `p-4` padding for canvas wrapper
- [ ] Apply `border border-gray-700` to containers
- [ ] Use standardized grid constants (50px offsets, 50px cells)
- [ ] Implement cursor feedback (default → grab → grabbing)
- [ ] Use 0.3s duration for return-to-origin animations
- [ ] Match info panel styling (semi-transparent bg, borders)
- [ ] Use combo indicator only when comboCount > 0
- [ ] Add "Engine: Konva.js" badge to show technology
- [ ] Ensure loading state matches main game styling

---

## Version History

### 2.0 (Current - Konva Migration)
- Migrated from Phaser to Konva.js
- Standardized dark theme
- Consistent info panel design
- Optimized bundle size

### 1.0 (Legacy - Phaser)
- Initial Phaser implementation
- Basic dark theme
- Inconsistent component styling

---

## References

- **Tailwind CSS**: https://tailwindcss.com/
- **Konva.js**: https://konvajs.org/
- **WCAG 2.1**: https://www.w3.org/WAI/WCAG21/quickref/

---

**Maintained by**: Development Team
**Review Cycle**: After major UI changes
