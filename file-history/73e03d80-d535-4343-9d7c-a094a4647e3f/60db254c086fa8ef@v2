/**
 * Debug Grid Rendering Test
 *
 * Simple test to capture console logs and verify grid rendering behavior
 */

import { test } from '@playwright/test';

test('debug grid rendering with drag and drop', async ({ page }) => {
  const consoleLogs: string[] = [];

  // Capture ALL console output
  page.on('console', msg => {
    const text = msg.text();
    console.log(`BROWSER: ${text}`);
    consoleLogs.push(text);
  });

  await page.goto('http://localhost:3001/demo');
  await page.waitForLoadState('networkidle');

  const canvas = await page.locator('canvas').first();
  await canvas.waitFor({ timeout: 15000 });

  // Wait for game initialization
  await page.waitForTimeout(3000);

  const canvasBounds = await canvas.boundingBox();
  if (!canvasBounds) {
    throw new Error('Canvas not found');
  }

  // Block position (first block at bottom)
  const blockX = canvasBounds.x + 280;
  const blockY = canvasBounds.y + 500;

  // Grid center position
  const gridX = canvasBounds.x + 100 + (4 * 50) + 25;
  const gridY = canvasBounds.y + 50 + (4 * 50) + 25;

  console.log(`\n=== STARTING DRAG ===`);
  console.log(`Block position: (${blockX}, ${blockY})`);
  console.log(`Grid target: (${gridX}, ${gridY})`);

  // Perform drag
  await page.mouse.move(blockX, blockY);
  await page.waitForTimeout(300);

  await page.mouse.down();
  await page.waitForTimeout(200);

  await page.mouse.move(gridX, gridY, { steps: 15 });
  await page.waitForTimeout(300);

  await page.mouse.up();
  await page.waitForTimeout(1000);

  console.log(`\n=== CONSOLE LOGS ===`);
  console.log(consoleLogs.join('\n'));
});
