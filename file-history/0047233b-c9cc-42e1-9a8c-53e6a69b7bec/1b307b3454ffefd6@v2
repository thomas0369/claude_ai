# Quick Start: Using Local Claude CLI (No API Needed)

## What This Does

The app calls your **local Claude installation** directly, just like running:

```bash
echo "your trading prompt" | claude
```

**No API keys, no API charges, completely local.**

---

## Step 1: Verify Claude CLI Works

Test that you can call Claude locally:

```bash
echo "Analyze EUR/USD at price 1.0850. Is this a good buy?" | claude
```

If you see a response from Claude, you're ready!

---

## Step 2: Test the Integration

Run the test script to verify the app can call Claude:

```bash
python test_claude_cli.py
```

Expected output:
```
Testing local Claude CLI integration...
================================================================================
Sending prompt to Claude CLI...
--------------------------------------------------------------------------------
Response received!
--------------------------------------------------------------------------------
{
  "signal": "buy",
  "confidence": 0.85,
  ...
}
--------------------------------------------------------------------------------

Parsed decision:
{
  "signal": "buy",
  "confidence": 0.85,
  ...
}

✅ Test successful! Claude CLI is working.
```

---

## Step 3: Run the Trading Bot

Run a single scan with local Claude:

```bash
# Screen EUR/USD and ask Claude for analysis
python src/claude_trading_bot.py --mode paper --method cli --symbols EUR/USD
```

Or scan all configured symbols:

```bash
python src/claude_trading_bot.py --mode paper --method cli
```

---

## How It Works Under the Hood

When the app finds a tradeable signal (score ≥ 75):

1. **Generates prompt** with market data, indicators, account state
2. **Calls local Claude**:
   ```python
   subprocess.run(
       ["claude"],
       input=prompt,
       capture_output=True
   )
   ```
3. **Parses response** - Extracts JSON decision from Claude's output
4. **Executes decision** - Paper trade or live trade based on mode

---

## Example Flow

```
1. Screener finds: EUR/USD score 125/194 (tradeable)
                        ↓
2. App builds Nof1-style prompt with:
   - Multi-timeframe data (M15, H1, H4, Daily)
   - Last 10 candles per timeframe
   - Scoring breakdown (125/194)
   - Account state
   - Recent trade history
                        ↓
3. App calls: echo "prompt" | claude
                        ↓
4. Claude analyzes and responds with JSON:
   {
     "signal": "buy",
     "confidence": 0.87,
     "justification": "Wave 3 confirmed at 0.618 Fib...",
     "exit_plan": {
       "stop_loss": 1.0817,
       "take_profit": 1.1119,
       "invalidation_reason": "..."
     }
   }
                        ↓
5. App parses response and logs paper trade
                        ↓
6. Trade stored with Claude's reasoning for feedback loop
```

---

## Troubleshooting

### "Claude CLI not found"

**Problem**: The `claude` command is not in your PATH.

**Solution**:
- If using Claude Code, make sure it's installed correctly
- Try running `which claude` to find the installation path
- If needed, add Claude to your PATH

### "Claude CLI timed out"

**Problem**: Claude is taking too long to respond (> 30 seconds).

**Solution**:
- Check your internet connection (Claude CLI may need to authenticate)
- Try a simpler prompt with the test script first
- Increase timeout in code if needed

### "No JSON object found in response"

**Problem**: Claude responded but didn't return JSON.

**Solution**:
- Check the saved prompt in `data/prompts/` to see what was sent
- Claude might have included explanatory text before the JSON
- The app should still extract JSON even with surrounding text

---

## Viewing Generated Prompts

All prompts are saved to `data/prompts/` for debugging:

```bash
# View the latest prompt sent to Claude
ls -lt data/prompts/ | head -5
cat data/prompts/EUR_USD_20250311_143000.txt
```

This shows exactly what Claude sees!

---

## Performance

**Local CLI**:
- ✅ No API charges
- ✅ Privacy (data stays local)
- ✅ No rate limits
- ⚠️ Slower than API (CLI overhead)
- ⚠️ Requires local Claude installation

**API Method** (alternative):
- ✅ Faster responses
- ✅ No local installation needed
- ⚠️ Requires API key
- ⚠️ API charges apply
- ⚠️ Data sent to Anthropic

---

## Next Steps

Once you've verified local CLI works:

1. Run daily scans:
   ```bash
   python src/claude_trading_bot.py --mode paper --method cli
   ```

2. Review Claude's decisions:
   ```bash
   python src/claude_trading_bot.py --show-performance
   ```

3. Check trade history with reasoning:
   ```python
   from trade_history_manager import TradeHistoryManager
   history = TradeHistoryManager()
   for trade in history.get_closed_trades():
       print(trade['llm_reasoning']['justification'])
   ```

4. Analyze prompts and responses in `data/prompts/`

---

## Summary

The app is **completely local** when using `--method cli`:

- ✅ No API keys needed
- ✅ No API charges
- ✅ All processing on your machine
- ✅ Just calls `claude` command like you would manually

Think of it as automating what you'd do manually: copy market data → paste into Claude → get analysis → execute trade.
