"""
Configuration for Elliott Wave Trading Bot
"""

import os
import logging
from typing import List
from dotenv import load_dotenv

# Load environment variables
load_dotenv()

# === BROKER CONFIGURATION ===
CAPITAL_API_KEY = os.getenv("CAPITAL_API_KEY", "")
CAPITAL_API_SECRET = os.getenv("CAPITAL_API_SECRET", "")
CAPITAL_PASSWORD = os.getenv("CAPITAL_PASSWORD", "")

# Capital.com API Mode
DEMO_MODE = os.getenv("DEMO_MODE", "true").lower() == "true"

# === DATA PROVIDER CONFIGURATION ===
# TradingView Integration (optional, requires tradingview-scraper)
TRADINGVIEW_ENABLED = os.getenv("TRADINGVIEW_ENABLED", "true").lower() == "true"


# === CONFIGURATION VALIDATION ===
def validate_config():
    """Validate required configuration is present"""
    required_vars = {
        "CAPITAL_API_KEY": CAPITAL_API_KEY,
        "CAPITAL_API_SECRET": CAPITAL_API_SECRET,
        "CAPITAL_PASSWORD": CAPITAL_PASSWORD,
    }

    missing = [k for k, v in required_vars.items() if not v]

    if missing and not DEMO_MODE:
        raise ValueError(
            f"Missing required environment variables: {', '.join(missing)}. "
            f"Set in .env file or GitHub Secrets."
        )
    elif missing and DEMO_MODE:
        logging.warning(f"Running in DEMO_MODE with missing credentials: {', '.join(missing)}")


# Call validation at module load
validate_config()

# === ASSET UNIVERSE ===
#
# RECOMMENDED CONFIGURATION: Conservative-Balanced Portfolio
# - Focus on liquid Forex majors + Gold (excellent Elliott Wave characteristics)
# - Moderate volatility with manageable risk
# - Optimal for FREE tier: 5 assets × 3 calls = 15 calls/scan → ~50 scans/day
#
# Asset Selection Criteria:
# ⭐⭐ EUR/USD: Most liquid, clear wave structures, LOW risk
# ⭐⭐ XAU/USD: Gold - respects Fibonacci exceptionally, MEDIUM risk
# ⭐⭐ GBP/USD: Higher volatility than EUR/USD, still liquid, LOW-MEDIUM risk
# ⭐  USD/JPY: Stable trends, predictable, LOW risk
# ⭐  AUD/USD: Commodity-linked, good trends, MEDIUM risk
#
# Removed from default (HIGH RISK):
# ❌ BTC/USD: Extreme volatility (2-5% daily), crypto risk
# ❌ ETH/USD: Extreme volatility (3-8% daily), crypto risk
# ❌ USD/CHF: Low volatility, less trending (kept as optional)

# FOREX MAJORS - Core portfolio (4 pairs)
FOREX_PAIRS: List[str] = [
    "EUR/USD",  # ⭐⭐ PRIORITY 1: Most liquid, clear Elliott Waves, 60-100 pips/day
    "GBP/USD",  # ⭐⭐ PRIORITY 2: Higher volatility, 100-150 pips/day
    "USD/JPY",  # ⭐  PRIORITY 3: Stable trends, 50-90 pips/day
    "AUD/USD",  # ⭐  PRIORITY 4: Commodity exposure, 60-100 pips/day
]

# COMMODITIES - Gold is exceptional for Elliott Wave (1 asset)
COMMODITIES: List[str] = [
    "XAU/USD",  # ⭐⭐ PRIORITY 1: Gold - respects Fibonacci levels, $15-30/day range
]

# OPTIONAL: Add these for more aggressive strategy (comment out by default)
FOREX_OPTIONAL: List[str] = [
    # "USD/CHF",  # Safe-haven, low volatility (40-70 pips/day)
]

CRYPTO: List[str] = [
    # "BTC/USD",  # ⚠️  HIGH RISK: 2-5% daily volatility, use with caution
    # "ETH/USD",  # ⚠️  HIGH RISK: 3-8% daily volatility, use with caution
]

# FUTURE EXPANSION (not yet supported by all providers):
INDICES: List[str] = [
    # "US500",   # S&P 500
    # "NAS100",  # NASDAQ 100
    # "GER40",   # DAX
]

# All tradeable assets
ALL_ASSETS = FOREX_PAIRS + COMMODITIES + FOREX_OPTIONAL + CRYPTO + INDICES

# === ASSET STATISTICS (For Reference) ===
# Asset Class    | Avg Daily Vol | Risk Level | Elliott Wave Quality | Priority
# --------------|---------------|------------|---------------------|----------
# EUR/USD       | 0.6-1.0%      | LOW        | ⭐⭐⭐⭐⭐            | ⭐⭐
# GBP/USD       | 1.0-1.5%      | LOW-MED    | ⭐⭐⭐⭐⭐            | ⭐⭐
# XAU/USD       | 1.0-1.5%      | MEDIUM     | ⭐⭐⭐⭐⭐            | ⭐⭐
# USD/JPY       | 0.5-0.8%      | LOW        | ⭐⭐⭐⭐             | ⭐
# AUD/USD       | 0.6-1.0%      | MEDIUM     | ⭐⭐⭐⭐             | ⭐
# USD/CHF       | 0.4-0.7%      | LOW        | ⭐⭐⭐              | Optional
# BTC/USD       | 2.0-5.0%      | HIGH       | ⭐⭐⭐⭐             | High Risk
# ETH/USD       | 3.0-8.0%      | HIGH       | ⭐⭐⭐⭐             | High Risk

# === TIMEFRAMES ===
TIMEFRAMES = {
    "daily": "1d",  # Makro-Trend-Filter
    "h4": "4h",  # Trend-Richtung
    "h1": "1h",  # HAUPT-ANALYSE (Setup-Identifikation)
    "m15": "15m",  # Entry-Timing
}

# === FIBONACCI-OPTIMIZED INDICATORS ===
# All Fibonacci numbers!
EMA_PERIODS: List[int] = [3, 5, 8, 13, 21, 34, 55, 89, 144, 200]

# Bollinger Bands (Golden Ratio)
BB_PERIOD = 21
BB_STD_DEV = 1.618  # Golden Ratio instead of standard 2.0

# Stochastic (Fibonacci)
STOCH_K = 13
STOCH_D = 5
STOCH_SMOOTH = 8

# ADX (Fibonacci)
ADX_PERIOD = 13

# RSI
RSI_PERIOD = 14

# === SCORING SYSTEM (Total: 113 points) ===
SCORE_WEIGHTS = {
    "fibonacci_levels": 34,  # Fibonacci retracements/extensions
    "ema_structure": 21,  # EMA alignment
    "stochastic": 13,  # Stochastic position
    "bollinger_bands": 13,  # BB squeeze/expansion
    "adx": 8,  # Trend strength
    "elliott_wave": 8,  # Wave pattern
    "fibonacci_time": 5,  # Time-based Fibonacci
    "volume": 3,  # Volume confirmation
    "confluence_bonus": 13,  # Multiple confirmations
}

# Minimum score to trigger trade
MIN_SCORE = 75
OPTIMAL_SCORE = 85

# === RISK MANAGEMENT (Golden Ratio) ===
PORTFOLIO_SIZE = 100.0  # EUR
POSITION_SIZE_PCT = 0.10  # 10% per trade
POSITION_SIZE = PORTFOLIO_SIZE * POSITION_SIZE_PCT  # 10 EUR

# Stop-Loss & Take-Profit (Fibonacci)
STOP_LOSS_PCT = 0.0236  # -2.36% (Fibonacci)
TAKE_PROFIT_PCT = 0.0618  # +6.18% (Golden Ratio)

# Risk/Reward Ratio
RISK_REWARD_RATIO = TAKE_PROFIT_PCT / STOP_LOSS_PCT  # 2.618:1

# Leverage based on score (8:5:3 Fibonacci Ratio)
LEVERAGE_MAP = {"low": 3, "medium": 5, "high": 8}  # Score 75-79  # Score 80-84  # Score 85+

# === TRADING HOURS (MEZ) ===
TRADING_START_HOUR = 9  # 09:00 MEZ
TRADING_END_HOUR = 16  # 16:00 MEZ (last entry)
FORCE_CLOSE_HOUR = 22  # 22:00 MEZ (force close all positions)

# === TRADING RULES ===
MAX_TRADES_PER_DAY = 1
INTRADAY_ONLY = True  # No overnight positions

# === DATA QUALITY ===
# Strict validation mode: False for testing (allows synthetic data), True for production
STRICT_DATA_VALIDATION = os.getenv("STRICT_DATA_VALIDATION", "false").lower() == "true"

# === DATA PATHS ===
DATA_DIR = "data"
SCREENING_RESULTS_FILE = f"{DATA_DIR}/screening_results.json"
TRADES_FILE = f"{DATA_DIR}/trades.json"
PERFORMANCE_FILE = f"{DATA_DIR}/performance.json"

# === EMAIL NOTIFICATIONS (Optional) ===
EMAIL_ENABLED = os.getenv("EMAIL_ENABLED", "false").lower() == "true"
EMAIL_USER = os.getenv("EMAIL_USER", "")
EMAIL_PASSWORD = os.getenv("EMAIL_PASSWORD", "")
EMAIL_TO = os.getenv("EMAIL_TO", "")
