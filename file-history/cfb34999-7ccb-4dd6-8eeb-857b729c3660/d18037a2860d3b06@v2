# Debug Mode Testing Guide

## Overview

Comprehensive debug logging has been added to `lib/game/phaser/entities/Block.ts` to help diagnose block interaction issues. When you click or interact with blocks, detailed information will be logged to the browser console.

## How to Test

### 1. Clear All Caches

**Important**: The dev server may have cached the old code. Follow these steps:

```bash
# Stop all dev servers
pkill -9 -f "next dev"
pkill -9 -f "npm run dev"

# Clear Next.js cache
rm -rf .next

# Start fresh dev server
PORT=3010 npm run dev
```

### 2. Open Browser with Hard Refresh

1. Open browser to: **http://localhost:3010/play/1**
2. Open Developer Console (F12)
3. Perform a **Hard Refresh** to bypass browser cache:
   - **Windows/Linux**: `Ctrl + Shift + R` or `Ctrl + F5`
   - **Mac**: `Cmd + Shift + R`

### 3. Look for Debug Banner

On page load, you should see this banner in the console:

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” BLOCK DEBUG MODE ACTIVE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Block.ts Module loaded - v10 (FORCE RELOAD)
Enhanced debug logging enabled:
  â€¢ POINTER DOWN events with coordinates
  â€¢ MOUSE OVER/OUT tracking
  â€¢ DRAG START confirmation
  â€¢ Hit area validation
  â€¢ Local/World coordinate conversion

When you click a block, you will see detailed logs!
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

**If you see "v8" instead of "v10"**: The browser is still using cached code. Try:
- Hard refresh again (Ctrl+Shift+R)
- Clear browser cache completely
- Try incognito/private window
- Close and restart the browser

### 4. Test Block Interactions

Once the game loads, try clicking on blocks in different positions:

#### Test 1: Click Block Center
- Click in the middle of any block
- You should see logs immediately

#### Test 2: Click Block Edges
- Click near the edges of the block
- Test top-left, top-right, bottom-left, bottom-right corners

#### Test 3: Drag Blocks
- Try to drag a block
- Watch for "DRAG START" logs

## Expected Log Output

### When You Click a Block (POINTER DOWN)

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ–±ï¸  POINTER DOWN on Block I
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ WORLD Coordinates:
   Pointer: (150, 500)
   Block Position: (100, 480)
   Block Size: 30x120

ğŸ“ LOCAL Coordinates (relative to block):
   Local X: 50
   Local Y: 20

ğŸ“ HIT AREA:
   Defined as: (0, 0) â†’ (30, 120)
   Click is âœ… INSIDE hit area

ğŸ“Š BLOCK DETAILS:
   Shape: 4x1 cells
   Color: #ff0000
   Active: true
   Visible: true
   Draggable: true
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

### When Mouse Enters Block (MOUSE OVER)

```
âœ… MOUSE OVER Block I at world (145, 495) â†’ local (45, 15)
```

### When Mouse Leaves Block (MOUSE OUT)

```
â¬…ï¸  MOUSE OUT from Block I
```

### When Drag Starts (DRAG START)

```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ¯ DRAG START - Block I
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ… DRAG INITIATED SUCCESSFULLY!
   Pointer: (150, 500)
   Block scaled to: 1.2x
   Block depth set to: 1000 (top layer)
   isDragging: true
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

## What to Look For

### âœ… Good Signs (Everything Working)
1. **POINTER DOWN** events fire when clicking anywhere on the block
2. **MOUSE OVER** fires when moving mouse onto block
3. **DRAG START** fires when trying to drag
4. Local coordinates show click is **âœ… INSIDE** hit area

### âŒ Problem Signs (Bug Present)
1. **NO logs appear** when clicking certain areas of the block
2. **MOUSE OVER never fires** for some positions
3. **DRAG START never fires** even though POINTER DOWN does
4. Local coordinates show click is **âŒ OUTSIDE** hit area
5. Only certain areas (like center) trigger events

## Reporting Results

### If Everything Works:
Send me this message:
```
âœ… All interactions work!
- POINTER DOWN fires everywhere
- DRAG START successful
- All clicks are INSIDE hit area
```

### If There Are Problems:
Copy the ENTIRE console output and send it to me, including:
1. The debug banner (to confirm v10 is loaded)
2. ALL logs from your click attempts
3. Note which areas of the block DO work and which DON'T

Example report:
```
âŒ Problem found:
- Banner shows: v10 âœ…
- Center click: Works, shows "âœ… INSIDE"
- Bottom-right click: NO LOGS AT ALL
- Drag: POINTER DOWN fires but no DRAG START
```

## Troubleshooting

### Problem: No Debug Banner Appears
**Solution**: Browser has cached old code
- Hard refresh: `Ctrl + Shift + R`
- Clear browser cache completely
- Try incognito window
- Restart browser entirely

### Problem: Banner Shows v8 Instead of v10
**Solution**: Dev server hasn't recompiled
```bash
# Kill all dev servers
pkill -9 -f "next dev"

# Clear cache
rm -rf .next

# Start fresh
PORT=3010 npm run dev
```
Wait 30-60 seconds for full compilation, then hard refresh browser.

### Problem: Game Doesn't Load
**Solution**: Check dev server is running
```bash
# Check if server is running
curl http://localhost:3010/play/1

# Should return 200, not 404 or connection refused
```

### Problem: Console Shows No Logs When Clicking
**Possible Causes**:
1. Clicking outside the canvas
2. Another element blocking the canvas
3. The original bug (blocks not responding to clicks)
   - **This is what we're trying to diagnose!**

## File Locations

- **Debug code**: `lib/game/phaser/entities/Block.ts` (lines 6-20, 272-345)
- **This guide**: `DEBUG_MODE_TESTING_GUIDE.md`
- **Test scripts**: `tests/e2e/verify-debug-mode.spec.ts`

## Quick Test Script

If you want to verify automatically first:

```bash
# Run verification test
npx playwright test tests/e2e/verify-debug-mode.spec.ts

# Look for:
# "Debug banner found: âœ… YES"
# "pointerdown listeners: âœ…"
```

Note: Playwright tests can verify the listeners are attached, but **cannot trigger actual Phaser events**. Manual browser testing is required to see the console logs from real interactions.

---

**Ready to test!** Open your browser to http://localhost:3010/play/1 and start clicking blocks. Watch the console for detailed debug output.
